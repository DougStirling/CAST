<!DOCTYPE HTML>
<html>
<head>
	<title>Inference with missing treatments</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="stylesheet" href="../../pageStyles.css" type="text/css">
	<script src="../../releaseInfo.js"></script>
	<script src="../../structure/pageSetup.js"></script>

	<meta name="index" content="anova, analysis of variance, missing treatments, marginal sum of squares, type 3 sum of squares">
	<meta name="dataset" content="Fertilisers and maize yield">
</head>


<body>
<script type="text/javascript">writePageStart();</script>

<p class="heading">Treatments with zero or one replicate</p>  
<p>In completely randomised experiments with a single replicate for all treatments, we showed earlier there are <a href="javascript:showNamedPage('factorial7')">no residual degrees of freedom</a> in the model with the highest-order interaction between all factors. If some of these treatments have zero replicates, there will be some  parameters in this model that cannot be estimated (as explained on the previous page), but there are still zero residual degrees of freedom in the full model.</p>
<p>In order to conduct hypothesis tests, we require residual degrees of freedom, so it must be assumed that there are no high-order interactions between the factors. The highest-order interaction sums of squares and degrees of freedom are treated as unexplained variation and are used as the residual sum of squares and degrees of freedom.</p>
<p class="heading">Problem with sequential sums of squares in anova table</p>
<p>If treatments in an experiment are missing randomly (rather than by design), the sums of squares explained by the factors and their interactions depend on the order of adding them to the model. The existance of several alternative analysis of variance tables (corresponding to different orderings of adding the main effects and interactions) complicates the analysis.</p>

<div class="diagram">
<p class="heading">Effect of fertilisers on maize yield</p>
<p>The data in the table below arose from a factorial experiment in which the quantities of nitrogen, potassium and phosphorus were varied.</p>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td align="center">&nbsp;</td>
		<td colspan="3" align="center">N = 10</td>
		<td width="30" align="center">&nbsp;</td>
		<td align="center">&nbsp;</td>
		<td colspan="3" align="center">N = 20</td>
		<td width="30" align="center">&nbsp;</td>
		<td align="center">&nbsp;</td>
		<td colspan="3" align="center">N = 30</td>
	</tr>
	<tr>
		<td align="center">&nbsp;</td>
		<td align="center">&nbsp;K=10&nbsp;</td>
		<td align="center">&nbsp;K=20&nbsp;</td>
		<td align="center">&nbsp;K=30&nbsp;</td>
		<td align="center">&nbsp;</td>
		<td align="center">&nbsp;</td>
		<td align="center">&nbsp;K=10&nbsp;</td>
		<td align="center">&nbsp;K=20&nbsp;</td>
		<td align="center">&nbsp;K=30&nbsp;</td>
		<td align="center">&nbsp;</td>
		<td align="center">&nbsp;</td>
		<td align="center">&nbsp;K=10&nbsp;</td>
		<td align="center">&nbsp;K=20&nbsp;</td>
		<td align="center">&nbsp;K=30&nbsp;</td>
	</tr>
	<tr>
		<td align="center">P&nbsp;=&nbsp;10&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-top:1px solid #999999; border-left:1px solid #999999;">65</td>
		<td align="center" bgcolor="#FFFFFF" style="border-top:1px solid #999999;">80</td>
		<td align="center" bgcolor="#FFFFFF" style="border-top:1px solid #999999; border-right:1px solid #999999;">104</td>
		<td align="center">&nbsp;</td>
		<td align="center">P&nbsp;=&nbsp;10&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-top:1px solid #999999; border-left:1px solid #999999;">86</td>
		<td align="center" bgcolor="#FFFFFF" style="border-top:1px solid #999999;">107</td>
		<td align="center" bgcolor="#FFFFFF" style="border-top:1px solid #999999; border-right:1px solid #999999;">129</td>
		<td align="center">&nbsp;</td>
		<td align="center">P&nbsp;=&nbsp;10&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-top:1px solid #999999; border-left:1px solid #999999;">108</td>
		<td align="center" bgcolor="#FFFFFF" style="border-top:1px solid #999999;">129</td>
		<td align="center" bgcolor="#FFFFFF" style="border-top:1px solid #999999; border-right:1px solid #999999;">141</td>
	</tr>
	<tr>
		<td align="center">P&nbsp;=&nbsp;20&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-left:1px solid #999999;">10</td>
		<td align="center" bgcolor="#FFFFFF">&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-right:1px solid #999999;">126</td>
		<td align="center">&nbsp;</td>
		<td align="center">P&nbsp;=&nbsp;20&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-left:1px solid #999999;">107</td>
		<td align="center" bgcolor="#FFFFFF">&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-right:1px solid #999999;">&nbsp;</td>
		<td align="center">&nbsp;</td>
		<td align="center">P&nbsp;=&nbsp;20&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-left:1px solid #999999;">125</td>
		<td align="center" bgcolor="#FFFFFF">143</td>
		<td align="center" bgcolor="#FFFFFF" style="border-right:1px solid #999999;">&nbsp;</td>
	</tr>
	<tr>
		<td align="center">P&nbsp;=&nbsp;30&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-bottom:1px solid #999999; border-left:1px solid #999999;">107</td>
		<td align="center" bgcolor="#FFFFFF" style="border-bottom:1px solid #999999;">126</td>
		<td align="center" bgcolor="#FFFFFF" style="border-bottom:1px solid #999999; border-right:1px solid #999999;">148</td>
		<td align="center">&nbsp;</td>
		<td align="center">P&nbsp;=&nbsp;30&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-bottom:1px solid #999999; border-left:1px solid #999999;">125</td>
		<td align="center" bgcolor="#FFFFFF" style="border-bottom:1px solid #999999;">144</td>
		<td align="center" bgcolor="#FFFFFF" style="border-bottom:1px solid #999999; border-right:1px solid #999999;">168</td>
		<td align="center">&nbsp;</td>
		<td align="center">P&nbsp;=&nbsp;30&nbsp;</td>
		<td align="center" bgcolor="#FFFFFF" style="border-bottom:1px solid #999999; border-left:1px solid #999999;">149</td>
		<td align="center" bgcolor="#FFFFFF" style="border-bottom:1px solid #999999;">163</td>
		<td align="center" bgcolor="#FFFFFF" style="border-bottom:1px solid #999999; border-right:1px solid #999999;">184</td>
	</tr>
</table>

<p>Note that there are four missing values from the complete factorial design, leaving the design unbalanced. The sum of squares table below only shows the main effects of the three factors &mdash; we will consider their interactions later.</p>

<div class="centred">
<applet codebase="../../java" code="dataView.CastApplet.class" archive="coreCAST.jar" width="550" height="200">
<script type="text/javascript">writeAppletParams();</script>
<param name="appletName" value="glmAnovaProg.AnovaTableReorderApplet">
<param name="yVarName" value="Maize yield">
<param name="yValues" value="65 80 104 87 126 107 126 148 86 107 129 107 125 144 168 108 129 141 125 143 149 163 184">
<param name="xVariables" value="N1 N2 P1 P2 K1 K2">
<param name="N1VarName" value="Nitrogen1">
<param name="N1Values" value="8@0 15@1">
<param name="N2VarName" value="Nitrogen2">
<param name="N2Values" value="15@0 8@1">
<param name="P1VarName" value="Phosphorus1">
<param name="P1Values" value="3@0 5@1 3@0 4@1 3@0 5@1">
<param name="P2VarName" value="Phosphorus2">
<param name="P2Values" value="5@0 3@1 4@0 3@1 5@0 3@1">
<param name="K1VarName" value="Potassium1">
<param name="K1Values" value="0 1 1 0 1 0 1 1 0 1 1 0 0 1 1 0 1 1 0 1 0 1 1">
<param name="K2VarName" value="Potassium2">
<param name="K2Values" value="0 0 1 0 1 0 0 1 0 0 1 0 0 0 1 0 0 1 0 0 0 0 1">
<param name="maxSsq" value="9999.9 99">
<param name="maxBarSsq" value="8000.0">
<param name="xGroups" value="2:N:Nitrogen#2:P:Phosphorous#2:K:Potassium">
</applet>
</div>

<p>Drag the red arrows to reorder of adding the terms in the table and observe that the sums of squares change. (The dark bars represent the sequential sums of squares; the thin lighter bars show the sums of squares for the terms if they were added <strong>last</strong> to the model.) For example, the table below shows the sums of squares explained by <strong>Nitrogen</strong> in the different orderings:</p>
<div class="centred"><table border="0" class="centred" cellpadding="3" cellspacing="0">
	<tr>
		<th>Order</th>
		<th>Sum of squares</th>
	</tr>
	<tr>
		<td bgcolor="#FFFFFF" style="border-top:1px solid #999999;">Added first</td>
		<td align="center" bgcolor="#FFFFFF" style="border-top:1px solid #999999;">5588.2</td>
	</tr>
	<tr>
		<td bgcolor="#FFFFFF">Added after Phosphorous</td>
		<td align="center" bgcolor="#FFFFFF">5594.9</td>
	</tr>
	<tr>
		<td bgcolor="#FFFFFF">Added after Potassium</td>
		<td align="center" bgcolor="#FFFFFF">6298.3</td>
	</tr>
	<tr>
		<td bgcolor="#FFFFFF" style="border-bottom:1px solid #999999;">Added after both others</td>
		<td align="center" bgcolor="#FFFFFF" style="border-bottom:1px solid #999999;">6297.7</td>
	</tr>
</table></div>

<p>In this example, the differences are relatively slight and the conclusions are the same &mdash; in a full analysis of variance table, all p-values are reported to be 0.0000. However the differences can be much greater depending on the pattern of missing values.</p>
</div>

<p class="heading">Marginal sums of squares</p>
<p>When trying to find the model for any data set that fits  best, a good approach is to start with a reasonably complete model with many terms, then investigate non-significant terms that can be dropped.</p>
<p>At each stage, the relevant sums of squares (and associated p-value) that are compared are the explained sums of squares for the terms under consideration when they are last added to the model. These are reductions to the residual sum of squares when the terms are dropped from the full model and are called <strong>marginal</strong> or <strong>Type 3</strong> sums of squares. The procedure will be illustrated in the example below.</p>
<p>Note that:</p>
<div class="centred"><div class="boxed">
	<p>You should never consider dropping any term from the model if a higher-order interaction involving it is still in the model.</p>
</div></div>
<br>

<div class="diagram"> 
<p class="heading">Effect of fertilisers on maize yield</p>
<p>The table below shows the marginal (Type 3) sums of squares for the main effects and interactions in the data shown at the top of this page. Since there are treatments with more than one replicate, we must assume that there is no 3-factor interaction in order to test the significance of the other terms. Although the 3-factor interaction would have 8 degrees of freedom if all treatments were present, the missing values result in 4 degrees of freedom which now become the residual degrees of freedom.</p>
<div class="centred"> 
<applet codebase="../../java" code="dataView.CastApplet.class" archive="coreCAST.jar" width="600" height="240">
<script type="text/javascript">writeAppletParams();</script>
<param name="appletName" value="indicatorProg.Type3InteractApplet">
<param name="yVarName" value="Maize yield">
<param name="yValues" value="65 80 104 87 126 107 126 148 86 107 129 107 125 144 168 108 129 141 125 143 149 163 184">
<param name="xVariables" value="N P K">
<param name="NVarName" value="Nitrogen">
<param name="NValues" value="8@0 7@1 8@2">
<param name="NLabels" value="10 20 30">
<param name="PVarName" value="Phosphorus">
<param name="PValues" value="3@0 2@1 3@2 3@0 1@1 3@2 3@0 2@1 3@2">
<param name="PLabels" value="10 20 30">
<param name="KVarName" value="Potassium">
<param name="KValues" value="0 1 2 0 2 0 1 2 0 1 2 0 0 1 2 0 1 2 0 1 0 1 2">
<param name="KLabels" value="10 20 30">
<param name="maxTableEntries" value="9999.9 99 9999.9 99.99">
<param name="customText" value="Type 3 ssq=Type 3 ssq#df=df#Mean ssq=Mean ssq">
</applet> 
</div>

<p>In the model with all 2-factor interactions, we can consider dropping any of the 2-factor interactions but <strong>not the main effects</strong> &mdash; they are greyed out.</p>
<p>The phosphorus-potassium interaction is least significant so it should be dropped from the model first &mdash; click the checkbox to its left on the table to remove it. Since the data are unbalanced, all other sums of squares and p-values change.</p>
<p>Now remove the nitrogen-phosphorus interaction term &mdash; its p-value is 0.0911. Again the marginal sums of squares and their p-values change. Since there are no longer any interaction terms in the model involving phosphorus, we can now also consider dropping its main effect and it is no longer greyed out in the table.</p>
<p>After dropping the final interaction term, all main effects are highly significant, so we would conclude that:</p>
<div class="centred"><div class="boxed">
	<p>There is no evidence of interaction between the effects of the three fertilisers but all three fertilisers do affect the yield.</p>
</div></div>

<p>Analysis of the data should proceed with an examination of the parameter estimates. Because of the lack of balance in the data, tables of factor means do not adequately describe the factor effects. For example, the experimental units getting phosphorus&nbsp;=&nbsp;10 tend to have higher potassium than those getting phosphorus&nbsp;=&nbsp;20, so the table of means for the phosphorus levels cannot indicate whiether it is phosphorus or potassium that is causing the difference.</p>
<p>The table below shows the parameter estimates (and 95% confidence intervals) for all parameters in the model with only main effects for all factors. All three fertilisers seem to have almost the same effect on yield and their effects all increase fairly linearly.</p>
<div class="centred">
<applet codebase="../../java" code="dataView.CastApplet.class" archive="coreCAST.jar" width="520" height="300">
<script type="text/javascript">writeAppletParams();</script>
<param name="appletName" value="exper2Prog.ParamCisApplet">
<param name="yVarName" value="Maize yield">
<param name="yValues" value="65 80 104 87 126 107 126 148 86 107 129 107 125 144 168 108 129 141 125 143 149 163 184">
<param name="xVariables" value="N P K">
<param name="NVarName" value="Nitrogen">
<param name="NValues" value="8@0 7@1 8@2">
<param name="NLabels" value="10 20 30">
<param name="PVarName" value="Phosphorus">
<param name="PValues" value="3@0 2@1 3@2 3@0 1@1 3@2 3@0 2@1 3@2">
<param name="PLabels" value="10 20 30">
<param name="KVarName" value="Potassium">
<param name="KValues" value="0 1 2 0 2 0 1 2 0 1 2 0 0 1 2 0 1 2 0 1 0 1 2">
<param name="KLabels" value="10 20 30">
<param name="maxParam" value="999.99">
<param name="customText" value="Parameter estimates (& 95% CIs)=Parameter estimates (& 95% CIs)">
</applet>
</div>
<p>Note that the  estimates for each factor are <strong>differences</strong> between the mean yield at the factor levels and the baseline level.</p>
</div>


<script type='text/javascript'>writePageEnd();</script>

</body>
</html>
